<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Testar — Filtro HT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f7f7f7; }
    h1 { margin-bottom: 5px; }
    .card {
        background: #fff; padding: 15px; border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    textarea { width: 100%; height: 200px; font-family: monospace; }
    button {
        padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer;
        font-size: 14px;
    }
    .btn-primary { background:#0066ff; color:white; }
    .btn-secondary { background:#ddd; }
    .btn-ghost { background:#eee; }
    .row { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
    .muted { color:#555; font-size:13px; }
    pre { background:#111; color:#0f0; padding:10px; border-radius:6px; white-space:pre-wrap; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border:1px solid #ccc; padding:8px; text-align:left; }
</style>
</head>

<body>

<h1><strong>Testar — Filtro HT</strong></h1>
<p class="muted">Página de testes para enviar JSON e visualizar resposta da API.</p>

<div class="card">
    <label><strong>Endpoint da API:</strong></label>
    <input id="endpoint" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc;"
           value="https://filtro-ht-vercel.vercel.app/api/filtro">
</div>

<div class="card">
    <label><strong>JSON de entrada:</strong></label>
    <textarea id="json"></textarea>

    <div class="row" style="margin-top:10px;">
        <button class="btn-secondary" onclick="validateJSON()">Validar JSON</button>
        <button class="btn-primary" onclick="sendToApi()">Enviar para API</button>
        <button class="btn-secondary" onclick="loadSample()">Carregar exemplo</button>
        <button class="btn-secondary" onclick="clearAll()">Limpar</button>
    </div>
</div>

<div class="card">
    <h3>Parsed / Preview</h3>
    <pre id="preview">(nenhum JSON processado ainda)</pre>
</div>

<div class="card">
    <h3>Resposta da API / Logs</h3>
    <pre id="response">(nenhuma requisição ainda)</pre>
</div>

<div class="card">
    <h3>Resultados</h3>
    <table id="resultsTable">
        <thead>
            <tr><th>#</th><th>ID</th><th>League</th><th>Probabilidade</th><th>Odds</th><th>Motivo</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
function validateJSON() {
    const txt = document.getElementById("json").value.trim();
    const preview = document.getElementById("preview");

    try {
        const obj = JSON.parse(txt);
        preview.textContent = JSON.stringify(obj, null, 2);
        return true;
    } catch(e) {
        preview.textContent = "ERRO DE JSON: " + e.message;
        return false;
    }
}

function loadSample() {
    const example = {
        matches: [
            {
              id: "m1",
              home: { ht_goal_pct: 0.32, avg_shots_ht: 2.1, xG_ht: 0.15 },
              away: { ht_goal_pct: 0.18, avg_shots_ht: 1.3, xG_ht: 0.05 },
              league: "Scottish Premiership",
              kickoff: "2025-12-04T20:00:00Z"
            },
            {
              id: "m2",
              home: { ht_goal_pct: 0.12, avg_shots_ht: 0.9, xG_ht: 0.02 },
              away: { ht_goal_pct: 0.45, avg_shots_ht: 3.0, xG_ht: 0.35 },
              league: "Serie A",
              kickoff: "2025-12-05T18:30:00Z"
            }
        ]
    };

    document.getElementById("json").value = JSON.stringify(example, null, 2);
    validateJSON();
}

function clearAll() {
    document.getElementById("json").value = "";
    document.getElementById("preview").textContent = "(nenhum JSON processado ainda)";
    document.getElementById("response").textContent = "(nenhuma requisição ainda)";
    document.querySelector("#resultsTable tbody").innerHTML = "";
}

async function sendToApi() {
    if (!validateJSON()) return;

    const endpoint = document.getElementById("endpoint").value.trim();
    const jsonTxt = document.getElementById("json").value.trim();
    const responseEl = document.getElementById("response");

    responseEl.textContent = "Enviando...";

    try {
        const data = JSON.parse(jsonTxt);

        const res = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const text = await res.text();

        if (!res.ok) {
            responseEl.textContent = "Erro HTTP " + res.status + ":\n" + text;
            return;
        }

        let parsed;
        try { parsed = JSON.parse(text); }
        catch { responseEl.textContent = "Resposta não-JSON:\n" + text; return; }

        responseEl.textContent = JSON.stringify(parsed, null, 2);

        if (parsed.results) renderResults(parsed.results);

    } catch(e) {
        responseEl.textContent = "Erro: " + e.message;
    }
}

function renderResults(results) {
    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    results.forEach((m, i) => {
        const tr = document.createElement("tr");

        const prob = m.probability ?? 0;
        const odds = prob > 0 ? (1 / prob).toFixed(2) : "-";

        tr.innerHTML = `
            <td>${i+1}</td>
            <td>${m.id || "-"}</td>
            <td>${m.league || "-"}</td>
            <td>${(prob * 100).toFixed(1)}%</td>
            <td>${odds}</td>
            <td>${m.reason || "-"}</td>
        `;

        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
